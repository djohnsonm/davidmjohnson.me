
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>david m. johnson</title>
  <meta name="author" content="david m. johnson">

  
  <meta name="description" content="If your github.js plugin displays a &#8220;Loading repos&#8230;&#8221; message then it&#8217;s using an old API. This can be fixed by replacing your &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://davidmjohnson.me/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="david m. johnson" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34145525-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">david m. johnson</a></h1>
  
    <h2>[code] -> [tangents] -> [stuff] -> dmj</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:davidmjohnson.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://careers.stackoverflow.com/davidmjohnson">Resume</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/28/fixing-the-repos-loading-dot-dot-dot-message-in-octopress/">Fixing the &#8216;Repos Loading&#8230;&#8217; Message in Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-28T23:01:00-05:00" pubdate data-updated="true">Aug 28<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/28/fixing-the-repos-loading-dot-dot-dot-message-in-octopress/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If your github.js plugin displays a &#8220;Loading repos&#8230;&#8221; message then it&#8217;s using an old API. This can be fixed by replacing your github.js file with the one depicted below.</p>

<p>The pull request may or may not get accepted but here it is: <a href="https://github.com/imathis/octopress/pull/732">#732</a></p>

<figure class='code'><figcaption><span>Github.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">github</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">repos</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">fragment</span> <span class="o">+=</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&quot;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">html_url</span> <span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;&lt;/a&gt;&lt;p&gt;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">description</span><span class="o">+</span><span class="s1">&#39;&lt;/p&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="nx">t</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">fragment</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">showRepos</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;https://api.github.com/users/&quot;</span><span class="o">+</span><span class="nx">options</span><span class="p">.</span><span class="nx">user</span><span class="o">+</span><span class="s2">&quot;/repos?callback=?&quot;</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">+</span> <span class="s1">&#39; li.loading&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Error loading feed&quot;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">repos</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>           <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>           <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">skip_forks</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">fork</span><span class="p">)</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>              <span class="nx">repos</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="nx">repos</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">aDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">pushed_at</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">(),</span>
</span><span class='line'>                <span class="nx">bDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">pushed_at</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">aDate</span> <span class="o">===</span> <span class="nx">bDate</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">aDate</span> <span class="o">&gt;</span> <span class="nx">bDate</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>          <span class="nx">render</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">repos</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/28/fixing-github-dot-js-in-octopress/">github.js in Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-28T21:56:00-05:00" pubdate data-updated="true">Aug 28<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/28/fixing-github-dot-js-in-octopress/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If your github.js plugin displays a &#8220;Loading repos&#8230;&#8221; messages then it&#8217;s using an old API. This can be fixed by replacing the github.js file with the one depicted below.</p>

<p>The pull request may or may not get accepted but here it is.
<a href="https://github.com/imathis/octopress/pull/732">#732</a></p>

<figure class='code'><figcaption><span>Github.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">github</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">repos</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">target</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">fragment</span> <span class="o">+=</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&quot;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">html_url</span> <span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;&lt;/a&gt;&lt;p&gt;&#39;</span><span class="o">+</span><span class="nx">repos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">description</span><span class="o">+</span><span class="s1">&#39;&lt;/p&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="nx">t</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">fragment</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">showRepos</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;https://api.github.com/users/&quot;</span><span class="o">+</span><span class="nx">options</span><span class="p">.</span><span class="nx">user</span><span class="o">+</span><span class="s2">&quot;/repos?callback=?&quot;</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">+</span> <span class="s1">&#39; li.loading&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Error loading feed&quot;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">repos</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>           <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>           <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">skip_forks</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">fork</span><span class="p">)</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>              <span class="nx">repos</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="nx">repos</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">aDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">pushed_at</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">(),</span>
</span><span class='line'>                <span class="nx">bDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">pushed_at</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">aDate</span> <span class="o">===</span> <span class="nx">bDate</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">aDate</span> <span class="o">&gt;</span> <span class="nx">bDate</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>          <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span> <span class="nx">repos</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>          <span class="nx">render</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">repos</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/17/first-post-on-new-blog/">First Post on New Blog</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-17T13:11:00-05:00" pubdate data-updated="true">Aug 17<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/17/first-post-on-new-blog/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Welcome to the home of my new blog. I&#8217;ll be updating it shortly with better themes, migrated posts and pics</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/12/roll-your-own-twitter-feed-with-backbone-dot-js/">Roll Your Own Twitter Feed With Backbone.js</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-12T09:51:00-05:00" pubdate data-updated="true">May 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/05/12/roll-your-own-twitter-feed-with-backbone-dot-js/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://dl.dropbox.com/u/10021156/blog/Capture.png"></p>

<p>Backbone.js is a JavaScript framework that manages complexity on the client while enabling the creation of rich HTML5 applications in a MVC-style fashion. For the more tech-savvy:</p>

<blockquote><p>Backbone.js gives structure to web applications by providing models with key-value binding and custom events, collections with a rich API of enumerable functions, views with declarative event handling, and connects it all to your existing API over a RESTful JSON interface.</p></blockquote>


<h2>Setting the stage</h2>

<p>In this post we’re going to make our own sample Backbone.js app that utilizes Twitter’s search API to scrape tweets and display them with the underscore templating engine and twitter bootstrap themes with a subtle patterns background. Node.js will deliver our static html file while Dropbox will host our JavaScript files (providing us with a make-shift CDN “Content Delivery Network”). Our app will be hosted on www.cloudfoundry.com with www.c9.io as our staging server while using git as our source control.</p>

<h2>Final Result</h2>

<p>Usually with tutorials I scroll to the bottom to see if the example is even worth making, then I decide to read the post if it is. So let me save you the trouble of scrolling and just show the final result here. <iframe src="http://ghbtns.com/github-btn.html?user=djohnsonm&repo=Twitter-Feed&type=fork&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="95px" height="20px"></iframe></p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/ff.png"></p>

<h2>Setting up our server</h2>

<p>For those of you that don’t know node.js like me. It’s worth checking out and is compatible on all major operating systems. According to node’s site.</p>

<blockquote><p>Node.js is a platform built on Chrome’s JavaScript runtime for easily building fast, scalable network applications. Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient, perfect for data-intensive real-time applications that run across distributed devices.</p></blockquote>


<p>Some users of node are Microsoft, LinkedIn, eBay and Voxer.</p>

<p>For more info on getting started with node, express and npm (node package manager) check out this tutorial. For more info on what exactly node is, check out this link. There are also plenty of other great ebooks on Amazon.</p>

<p>If you’re coming from the Microsoft paradigm think of express as your ASP.NET MVC 3 web app framework. For our example we are only distributing one html file (since our app is a simple single-page app) that needs no server interaction. The code should be very straightforward.</p>

<figure class='code'><figcaption><span>Node.js app</span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Configuration</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// disable layout</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;view options&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">layout</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// make a custom html template</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">compile</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">options</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">locals</span><span class="p">){</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">({</span> <span class="nx">dumpExceptions</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">showStack</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="s1">&#39;production&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">());</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Express server listening on port %d in %s mode&quot;</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">address</span><span class="p">().</span><span class="nx">port</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">env</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Html</h2>

<p><img src="https://dl.dropbox.com/u/10021156/blog/hbp-1.png"></p>

<p>Main highlights here are as follows:</p>

<p>HTML5 boilerplate goodness
Underscore.js Templating
Using a CDN to shorten the load time of your scripts
Easy styling with Twitter Bootstrappin’</p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/bs.png"></p>

<p>Here we see by appending classes to div’s twitter bootstrap will easily create a persistent header with optional header text.</p>

<figure class='code'><figcaption><span>Twitter BootStrap Styles </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;header&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container-fluid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;brand&quot;</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Clarity Twitter Feed<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nav-collapse collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/header&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://dl.dropbox.com/u/10021156/blog/u.png"></p>

<p>Here in our tweet template we iterate through each tweet and display the respective content in tags and append the image url onto the “src” attribute of an tag.</p>

<figure class='code'><figcaption><span>Underscore.js style application </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/template&quot;</span> <span class="na">id=</span><span class="s">&quot;tweettemplate&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">nav</span> <span class="o">--&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">nav</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">button</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;refresh btn btn-success btn-large&quot;</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;icon-white icon-refresh&quot;</span><span class="o">&gt;&lt;</span><span class="err">/i&gt;Refresh</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">button</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;reverse btn btn-warning btn-large&quot;</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="nx">i</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;icon-white icon-resize-vertical&quot;</span><span class="o">&gt;&lt;</span><span class="err">/i&gt;Reverse</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/button&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/nav&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="o">/</span><span class="nx">nav</span> <span class="o">--&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">List</span> <span class="nx">of</span> <span class="nx">Tweets</span> <span class="o">--&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">section</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;tweetList&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>          <span class="o">&lt;%</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">tweets</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tweet</span><span class="p">)</span> <span class="p">{</span> <span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">li</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;tweet&quot;</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>                <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;head&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">img</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;pic&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;&lt;%= tweet.profile_image_url %&gt;&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">p</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;userId&quot;</span><span class="o">&gt;&lt;%=</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="nx">tweet</span><span class="p">.</span><span class="nx">from_user</span> <span class="o">%&gt;&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>                 <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>
</span><span class='line'>                 <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;%=</span> <span class="nx">tweet</span><span class="p">.</span><span class="nx">text</span> <span class="o">%&gt;&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">p</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;created&quot;</span><span class="o">&gt;&lt;%=</span> <span class="nx">tweet</span><span class="p">.</span><span class="nx">created_at</span> <span class="o">%&gt;&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>                 <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>                 <span class="o">&lt;</span><span class="nx">hr</span> <span class="o">/&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="err">/span&gt;</span>
</span><span class='line'>           <span class="o">&lt;</span><span class="err">/li&gt;  </span>
</span><span class='line'>
</span><span class='line'>          <span class="o">&lt;%</span> <span class="p">});</span> <span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'>          <span class="o">&lt;</span><span class="err">/ul&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/section&gt;</span>
</span><span class='line'>     <span class="c">&lt;!--</span> <span class="o">/</span><span class="nx">List</span> <span class="nx">of</span> <span class="nx">Tweets</span> <span class="o">--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<h2>The CSS</h2>

<p><img src="https://dl.dropbox.com/u/10021156/blog/sp.png"></p>

<p>This was a great exercise in learning more about CSS and some of the new CSS3 styles like dropshadow and border-radius. Going forward I’d like to use more style inheritance and eventually use LESS. (Actually, if you convert this CSS to LESS, it will look the exact same.)</p>

<figure class='code'><figcaption><span>The CSS </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'> <span class="nt">body</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-image</span><span class="o">:</span> <span class="sx">url(&#39;http://dl.dropbox.com/u/10021156/NsLayout/img/white_tiles.png&#39;)</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding-top</span><span class="o">:</span> <span class="m">60px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding-bottom</span><span class="o">:</span> <span class="m">40px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nf">#narrLogo</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">margin-left</span><span class="o">:</span><span class="m">34px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding</span> <span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nf">#message</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span><span class="k">absolute</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-left</span><span class="o">:</span><span class="m">152px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-top</span><span class="o">:</span><span class="m">24px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">nav</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">85</span><span class="o">%</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">19</span><span class="o">,</span><span class="m">101</span><span class="o">,</span><span class="m">53</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">6</span><span class="p">);</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span><span class="m">10px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-bottom</span><span class="o">:</span><span class="m">47px</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nf">#logo</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">50</span><span class="o">%</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin</span><span class="o">:</span> <span class="m">0px</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nf">#tweetList</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">list-style</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.hero-unit</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">1</span><span class="p">);</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span><span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding</span><span class="o">:</span><span class="m">20px</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.reverse</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">float</span><span class="o">:</span><span class="k">right</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.container-fluid</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">margin-left</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-right</span><span class="o">:</span><span class="k">auto</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">600px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.head</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span><span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding</span><span class="o">:</span><span class="m">10px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span><span class="m">5px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span><span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">.</span><span class="m">1</span><span class="p">);</span>
</span><span class='line'>  <span class="k">opacity</span><span class="o">:</span><span class="m">0</span><span class="o">.</span><span class="m">9</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">i</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-position</span> <span class="o">:</span> <span class="m">-435px</span> <span class="m">-119px</span> <span class="cp">!important</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">img</span><span class="nc">.pic</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">6px</span> <span class="m">8px</span> <span class="m">8px</span> <span class="m">#888</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span><span class="m">60px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.tail</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">padding</span><span class="o">:</span><span class="m">2px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.userId</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.created</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span><span class="m">14px</span> <span class="cp">!important</span><span class="p">;</span>
</span><span class='line'>  <span class="k">font-weight</span><span class="o">:</span><span class="k">bold</span> <span class="cp">!important</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-top</span><span class="o">:-</span><span class="m">13px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">background</span><span class="o">:</span><span class="nb">white</span><span class="p">;</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span><span class="m">5px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding</span><span class="o">:</span> <span class="m">0px</span> <span class="m">3px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-left</span><span class="o">:</span> <span class="m">14px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">opacity</span><span class="o">:</span><span class="m">0</span><span class="o">.</span><span class="m">9</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.userId</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">margin-left</span><span class="o">:</span><span class="m">10px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Model</h2>

<figure class='code'><figcaption><span>Backbone.js Model </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Tweet</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well that was easy. We can define our Tweets field names and default values by passing in a defaults object into the extend() method of the Model class. But since this is JavaScript we can add properties on the fly and default values would not make sense for the properties in this example.</p>

<h2>The View</h2>

<p>On initialize the view will call fetch on our collection of tweets which will use the sync method to initiate an ajax call to Twitter’s API.
The resulting data will then be passed through the parse method, into the render method, and applied to the template. It’s best to look at the View while looking at the Collection code. (see below).</p>

<figure class='code'><figcaption><span>Backbone.js View </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'> <span class="nx">TweetsView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;render&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// create a collection</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tweets</span><span class="p">;</span>
</span><span class='line'>           <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Fetch the collection and call render() method</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;fetched&quot;</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">that</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tweetContainer&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="c1">// Use an external template</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tweettemplate&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Fill the html with the template and the collection</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">({</span> <span class="nx">tweets</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="p">}));</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">events</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s1">&#39;click .refresh&#39;</span> <span class="o">:</span> <span class="s1">&#39;refresh&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;click .reverse&#39;</span> <span class="o">:</span> <span class="s1">&#39;reverse&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">refresh</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>     <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;refresh&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">);</span>
</span><span class='line'>     <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">reverse</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">reverse</span><span class="p">();</span>
</span><span class='line'>       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">reverse</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TweetsView</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Collection</h2>

<p>Here reverse will override our comparator to display tweets in reverse order by way of the ternary operator provided to us in JavaScript.</p>

<figure class='code'><figcaption><span>Backbone.js Collection </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Tweets</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nx">model</span><span class="o">:</span> <span class="nx">Tweet</span><span class="p">,</span>
</span><span class='line'>        <span class="c1">// Url to request when fetch() is called</span>
</span><span class='line'>        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://search.twitter.com/search.json?q=claritycon&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">sort_order</span> <span class="o">=</span> <span class="s1">&#39;desc&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">parse</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//modify dates to be more readable</span>
</span><span class='line'>            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">val</span><span class="p">.</span><span class="nx">created_at</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">created_at</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">val</span><span class="p">.</span><span class="nx">created_at</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>              <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="c1">// Overwrite the sync method to pass over the Same Origin Policy</span>
</span><span class='line'>        <span class="nx">sync</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>                    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">url</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">processData</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>                <span class="p">},</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">comparator</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">activity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is comparing&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">activity</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sort_order</span> <span class="o">==</span> <span class="s1">&#39;desc&#39;</span>
</span><span class='line'>                 <span class="o">?</span> <span class="o">-</span><span class="nx">date</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
</span><span class='line'>                 <span class="o">:</span>  <span class="nx">date</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">reverse</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;this is reversing&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">sort_order</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sort_order</span> <span class="o">==</span> <span class="s1">&#39;desc&#39;</span> <span class="o">?</span> <span class="s1">&#39;asc&#39;</span> <span class="o">:</span> <span class="s1">&#39;desc&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<h2>Refresh and Reverse</h2>

<p>When refresh is clicked you can watch the ajax call in Chrome tools.</p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/tweeter.png"></p>

<h2>A note about Twitter’s APIs</h2>

<p><img src="https://dl.dropbox.com/u/10021156/blog/twitter.png"></p>

<p>The twitter API comes in 1 of 3 flavors. For our example we will use the search API which will allow us to retrieve tweets in jsonp (json with “padding”) and parse them on the client. It’s important to note that we are making a cross-domain request so we have to use jsonp to avoid the “same-origin policy” issue. One thing to also note, the search API only allows for 150 requests per hour per client and is limited in the amount of tweets that can be retrieved as well as historically how far back you can dig up tweets.</p>

<h2>Git it</h2>

<p><img src="https://dl.dropbox.com/u/10021156/blog/git.png"></p>

<p>Probably the simplest and easiest commands you will use when deploying your site to a hosting provider like github, heroku, appharbor. Just remember these few simple commands and you will be able to upload any app anywhere.</p>

<figure class='code'><figcaption><span>Git goodness </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git init //initializes the repo
</span><span class='line'>git add . //adds all files in the current directory to the repo’s changeset
</span><span class='line'>git commit -m “First Commit” //commits all the changes to the repo
</span><span class='line'>git remote add github git@github.com:<span class="o">(</span>username<span class="o">)</span>/<span class="o">(</span>reponame<span class="o">)</span>.git
</span><span class='line'>git push github master
</span><span class='line'>You can now import your github repo into www.c9.io and deploy it to cloud foundry.
</span></code></pre></td></tr></table></div></figure>


<p>Get the source here: <iframe src="http://ghbtns.com/github-btn.html?user=djohnsonm&repo=Twitter-Feed&type=fork&count=true"
  allowtransparency="true" frameborder="0" scrolling="0" width="95px" height="20px"></iframe></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/31/testing-html5-web-apps-with-watir/">Testing HTML5 Web Apps With WATIR</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-31T13:59:00-05:00" pubdate data-updated="true">Aug 31<span>st</span>, 2011</time>
        
         | <a href="/blog/2011/08/31/testing-html5-web-apps-with-watir/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://dl.dropbox.com/u/10021156/blog/InteractiveRuby.png"></p>

<h2>What is WATIR?</h2>

<p>Watir means “Web Application Testing in Ruby.” It’s an easy way to automate the testing of your Web Apps through a Ruby interactive console. Watir will click buttons, fill in forms, navigate to pages, you name it. It’s also compatible with all major browsers.</p>

<h2>How do I get started?</h2>

<p>So let’s say hypothetically you have an HTML5 web app using jQuery Mobile running on top of ASP.NET MVC 3. A quick and easy way to test the UI functionality of a new user registration would be to use Watir.</p>

<h2>The Test</h2>

<iframe width="" height="" src="http://www.youtube.com/embed/640 320 sKsQFLB6ZG8 " frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>




<figure class='code'><figcaption><span>The Code </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#INTERACTIVE TESTING WITH RUBY GEMS</span>
</span><span class='line'><span class="c1">#LOAD UP RUBY GEMS, Watir and Watir-webdriver</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
</span><span class='line'><span class="c1">#this is for IE</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;watir&#39;</span>
</span><span class='line'><span class="c1">#this is for Chrome</span>
</span><span class='line'><span class="c1">#require &#39;watir-webdriver&#39;</span>
</span><span class='line'><span class="c1">#load Browser</span>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="no">Watir</span><span class="o">::</span><span class="no">Browser</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#go to URL</span>
</span><span class='line'><span class="n">b</span><span class="o">.</span><span class="n">goto</span> <span class="s1">&#39;http://watirtesting.apphb.com/&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Select the Register Link</span>
</span><span class='line'><span class="n">l</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span><span class="s2">&quot;Register&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">l</span><span class="o">.</span><span class="n">exists?</span>
</span><span class='line'><span class="n">l</span><span class="o">.</span><span class="n">click</span>
</span><span class='line'>
</span><span class='line'><span class="c1">##Populate Register Fields</span>
</span><span class='line'><span class="n">b</span><span class="o">.</span><span class="n">text_field</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">&quot;UserName&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Fake Name&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">b</span><span class="o">.</span><span class="n">text_field</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">&quot;Email&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;SampleUser@SampleUser.org&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">b</span><span class="o">.</span><span class="n">text_field</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">&quot;Password&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Password12345&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">b</span><span class="o">.</span><span class="n">text_field</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">&quot;ConfirmPassword&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Password12345&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">##Create New User</span>
</span><span class='line'><span class="n">b</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Register&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Who uses WATIR?</h2>

<p>Facebook
SAP
Oracle
Yahoo
Expedia</p>

<h2>Get WATIR</h2>

<p>Watir can be downloaded. You’ll need to install ruby as well. All watir commands can be run from the Ruby Interactive Console.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/11/getting-started-with-f-number/">Getting Started With F#</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-11T15:38:00-05:00" pubdate data-updated="true">Aug 11<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/08/11/getting-started-with-f-number/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>What is F#?</h2>

<p>F# is a multi-paradigm programming language combining functional, OOP and imperative styles. It is based on the ML variant of languages and is most closely related to OCaml. It is a strongly-typed language that utilizes type inference to resolve data-types at runtime. With the release of Visual Studio 2010, F# is now a first class citizen of the .NET Platform and fully compatible with most .NET libraries (including but not limited to WCF, WPF, XNA). F# is a great example of a specific type of programming called “functional programming.” The functional programming genre seeks to describe more of the “what” and less of the “how” in regards to programming. C# is slowly including more functional aspects into it overtime.</p>

<h2>Origins</h2>

<p>Most people don’t know this but C# actually owes a lot to F#. Don Syme, the originator of F#, was responsible for creating the concept of Generics in C# and also spent time working on LINQ. These features tend to be more functional in nature. Generics allow us to see code as data and LINQ is a very declarative way to retrieve and modify data from a variety of sources.</p>

<h2>Predictions</h2>

<p>General consensus about functional languages like F# is that they are primarily reserved for the halls of academia (i.e. LISP) but all that is about to change. As demand for multi-core and asynchronous computing increases the future of F# seems bright.</p>

<h2>Why should you care?</h2>

<blockquote><p>“Today we are facing new challenges and trends that open the door to functional languages. There has never been a better time to learn them. We need to write programs that process large sets of data and scale to a large number of processors or computers. We want to write programs that can be easily tested. We want to be able to express our logic in a declarative way which expresses results without explicitly specifying execution details–making the code easier to understand and reason about. All of these trends are embodied in functional programming…</p><footer><strong>Jon Skeet and Tomas Petricek</strong> <cite>Real World Functional Programming</cite></footer></blockquote>


<h2>What F# isn’t</h2>

<p>A replacement for C#. While both are very effective langauages in their respective domains and both can overlap in regards to functional and OOP aspects (as well as intermingle via interoperability), C# will most-likely be the first candidate for line-of-business applications due to its adoption levels, performance and pervasiveness in the market. Personally, I believe that F# will be important going forward given the convergence of a few market factors such as data growth, multi-core computing and the desire for elegance in code. Concurrent applications are harder to maintain in a pure object-oriented environment. Race conditions and dealing with thread locking can become very tedious as applications are expected to scale to meet market demand. The functional paradigm does not need to manage state and provides no “side effects”, thus making it much easier to scale applications across multiple cores.</p>

<h2>Who’s using F#?</h2>

<p>-Financial Services
–Algorithmic Trading
-Statistical analysis
-Application Development
-Web Development</p>

<h2>How Do I Get Started?</h2>

<p>I’ll go through some of the basics of F# in this lesson and provide follow-ups to links and books at the end. Let’s get started with our first example in F#, but before we can do that we need to set up our development environment. In Visual Studio it is possible to create a new F# project by hitting “Ctrl-Shift-N” and creating a F# Console Application.
But for our purposes we will just use F# interactive which is a stand-alone command line utility. Great for rapid prototyping and learning the language. So navigate to (C:\Program Files (x86)\Microsoft F#\v4.0\fsi.exe). (Aside: You have to right-click the toolbar and select “paste” in order to insert code).</p>

<figure class='code'><figcaption><span>Simple Multiplication Function  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">multiply</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This function might seem ridiculous at first glance (it did for me), especially if you’re coming from a pure C# background, but let’s translate it to C# and see if it makes anymore sense.</p>

<figure class='code'><figcaption><span>Simple Multiplication Function in C#  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="kt">int</span> <span class="nf">multiply</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">x</span> <span class="p">*</span> <span class="n">y</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//or</span>
</span><span class='line'><span class="n">Func</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">multiply</span> <span class="p">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="p">*</span> <span class="n">y</span><span class="p">;</span> <span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Let</h2>

<p>The &#8220;Let&#8221; keyword might be familiar for those who have worked with LINQ. It might be tempting to think that this keyword is used for assignment. Think of it more as binding to a value rather than assigning a value. Since functions are first class citizens in F# and they can be passed around as parameters and contain return values.</p>

<h2>Val</h2>

<p>The “val multiply: int -> int -> int” can be thought of as: A function named “multiply” that takes an integer as a parameter returns a function that takes an integer as a parameter and outputs an integer. Confusing you say? Yes, absolutely. Why didn’t I just say: “A function that takes in two ints and returns and int.” Because of currying.</p>

<h2>Spicy Curry</h2>

<p>There is something called “currying” in F# that you should be wary of. Currying is the process of partial function application. This allows us to specify only one parameter of a function to receive a function that takes in the other parameter. Here is an example in code:</p>

<figure class='code'><figcaption><span>Curried Multiplication Function in F#  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">&gt;</span> <span class="k">let</span> <span class="n">multiply</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;;</span>
</span><span class='line'><span class="k">val</span> <span class="n">multiply</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span>
</span><span class='line'><span class="o">&gt;</span> <span class="k">let</span> <span class="n">curriedMultiplyX</span> <span class="o">=</span> <span class="n">x</span> <span class="mi">5</span><span class="o">;;</span>
</span><span class='line'><span class="k">val</span> <span class="n">curriedMultiplyX</span> <span class="o">:</span> <span class="o">(</span><span class="kt">int</span> <span class="o">-&gt;</span> <span class="kt">int</span><span class="o">)</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">curriedMultiplyX</span> <span class="mi">7</span><span class="o">;;</span>
</span><span class='line'><span class="k">val</span> <span class="n">it</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">curriedMultiplyX</span> <span class="mi">9</span><span class="o">;;</span>
</span><span class='line'><span class="k">val</span> <span class="n">it</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">14</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice how I only specify one parameter for the function named “x”? “x 5″ is saying that I want to return a function that is based on the function named “x” but applies the number 5 as a parameter every time basically.</p>

<h2>Visualization</h2>

<p>F# can also be utilized for visualiztion. Below is a Windows forms example. Copy and paste it into your F# interactive console.</p>

<h2>Windows Forms Example</h2>

<p>In F# Interactive write the following code:</p>

<figure class='code'><figcaption><span>F# Windows Forms Example  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">open</span> <span class="nc">System</span>
</span><span class='line'><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Windows</span><span class="p">.</span><span class="nc">Forms</span>
</span><span class='line'><span class="k">let</span> <span class="n">form</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Form</span><span class="o">(</span><span class="nc">Text</span><span class="o">=</span><span class="s2">&quot;Welcome to F# Win Form Style&quot;</span><span class="o">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">label</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Label</span><span class="o">(</span><span class="nc">Text</span> <span class="o">=</span> <span class="s2">&quot;This is a label!&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">form</span><span class="o">.</span><span class="nn">Controls</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="n">label</span><span class="o">)</span>
</span><span class='line'><span class="n">form</span><span class="o">.</span><span class="nc">Show</span><span class="bp">()</span><span class="o">;;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see it’s pretty easy to prototype in F# using the interactive console.
<img src="https://dl.dropbox.com/u/10021156/FViz1.png"></p>

<figure class='code'><figcaption><span>Recursive Factorial Function in F#  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="k">rec</span> <span class="n">fac</span> <span class="n">param</span> <span class="o">=</span> <span class="k">if</span> <span class="n">param</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">else</span> <span class="n">param</span> <span class="o">*</span> <span class="n">fac</span><span class="o">(</span><span class="n">param</span> <span class="o">-</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">);;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code calculates the factorial of any number passed in using familiar “if..then” logic. Also, if you are getting strange results, remember that indentation matters in F#, but its really doesn’t inhibit your productivity.</p>

<figure class='code'><figcaption><span>Recursive Factorial Function with Pattern Matching in F#  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="k">rec</span> <span class="o">(!)</span> <span class="n">x</span> <span class="o">=</span>
</span><span class='line'><span class="o">|</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">1</span>
</span><span class='line'><span class="o">|</span> <span class="o">_</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code should be pretty self-explanatory. The “rec” prefix means that this function is recursive. The (!) means that the name of this function is “!” (this is not operator overloading but a way to bind symbols to function names). The underscore value (“_”) is used as a placeholder variable for every possible value of n. The pipes are kind of like a switch statement on steroids. The value will navigate down the pipes and return the value “1″ if n is “0″ or “n-1″ for everything else and then multiply by the return value recursively.</p>

<p>Asychronous and Concurrent Programming using CPU bound operations.</p>

<p>Now for the fun stuff.
So let’s take our little factorial example see if we can calculate the factorial of every number from 0 to 51,000 utilizing Parallel Computing. Here’s the code for that. WARNING: If you don’t have a lot of memory then bring it down from 51,000 to something more manageable.</p>

<figure class='code'><figcaption><span>Async and Parallel Factorial Function  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="c">(* Declare our function *)</span>
</span><span class='line'><span class="k">let</span> <span class="k">rec</span> <span class="n">fac</span> <span class="n">param</span> <span class="o">=</span> <span class="k">if</span> <span class="n">param</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">else</span> <span class="n">param</span> <span class="o">*</span> <span class="n">fac</span><span class="o">(</span><span class="n">param</span> <span class="o">-</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">);;</span>
</span><span class='line'><span class="c">(* Asynchronous Example *)</span>
</span><span class='line'><span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span> <span class="o">[</span><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">..</span><span class="mi">51000</span><span class="o">.</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">async</span> <span class="o">{</span> <span class="k">return</span> <span class="n">fac</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">}]</span> <span class="o">|&gt;</span> <span class="nn">Run</span><span class="p">.</span><span class="nc">Synchronously</span><span class="o">;;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I’ll perform the operation on an 8-Core machine with Diagnostics so we can visualize the processor usage better.</p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/8CoreSynch1-1024x121.png"></p>

<figure class='code'><figcaption><span>Simple Computation Results (Synchronous, non-Parallel) – 41 seconds  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">open</span> <span class="nc">System</span>
</span><span class='line'><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">Diagnostics</span>
</span><span class='line'><span class="k">let</span> <span class="k">rec</span> <span class="n">fac</span> <span class="n">x</span> <span class="o">=</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span> <span class="o">*</span> <span class="n">fac</span><span class="o">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">watch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Stopwatch</span><span class="bp">()</span>
</span><span class='line'><span class="n">watch</span><span class="o">.</span><span class="nc">Start</span><span class="bp">()</span>
</span><span class='line'><span class="k">let</span> <span class="n">simpleComputation</span> <span class="o">=</span> <span class="o">[</span><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">..</span><span class="mi">51000</span><span class="o">.</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">fac</span><span class="o">(</span><span class="n">i</span><span class="o">)]</span>
</span><span class='line'><span class="n">watch</span><span class="o">.</span><span class="nc">Stop</span><span class="bp">()</span>
</span><span class='line'><span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">watch</span><span class="o">.</span><span class="nn">Elapsed</span><span class="p">.</span><span class="nn">Seconds</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span>
</span><span class='line'><span class="n">printfn</span> <span class="s2">&quot;%s&quot;</span> <span class="n">result</span><span class="o">;;</span>
</span><span class='line'>
</span><span class='line'><span class="c">(* RESULTS *)</span>
</span><span class='line'><span class="k">val</span> <span class="n">fac</span> <span class="o">:</span> <span class="kt">float</span> <span class="o">-&gt;</span> <span class="kt">float</span>
</span><span class='line'><span class="k">val</span> <span class="n">watch</span> <span class="o">:</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Diagnostics</span><span class="p">.</span><span class="nc">Stopwatch</span>
</span><span class='line'><span class="k">val</span> <span class="n">simpleComputation</span> <span class="o">:</span> <span class="kt">float</span> <span class="kt">list</span> <span class="o">=</span>
</span><span class='line'>  <span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">6</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">24</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">120</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">720</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">5040</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">40320</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">362880</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span>
</span><span class='line'>   <span class="mi">3628800</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">39916800</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">479001600</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">6227020800</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">8</span><span class="o">.</span><span class="mi">71782912</span><span class="n">e</span><span class="o">+</span><span class="mi">10</span><span class="o">;</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">.</span><span class="mi">307674368</span><span class="n">e</span><span class="o">+</span><span class="mi">12</span><span class="o">;</span> <span class="mi">2</span><span class="o">.</span><span class="mi">092278989</span><span class="n">e</span><span class="o">+</span><span class="mi">13</span><span class="o">;</span> <span class="mi">3</span><span class="o">.</span><span class="mi">556874281</span><span class="n">e</span><span class="o">+</span><span class="mi">14</span><span class="o">;</span> <span class="mi">6</span><span class="o">.</span><span class="mi">402373706</span><span class="n">e</span><span class="o">+</span><span class="mi">15</span><span class="o">;...]</span>
</span><span class='line'><span class="k">val</span> <span class="n">result</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;41&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://dl.dropbox.com/u/10021156/blog/8CoreAsynParallel-1024x124.png"></p>

<figure class='code'><figcaption><span>Complex Computation Results (Asychronous, Parallel) – 13 seconds  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">open</span> <span class="nc">System</span>
</span><span class='line'><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">Diagnostics</span>
</span><span class='line'><span class="k">let</span> <span class="k">rec</span> <span class="n">fac</span> <span class="n">x</span> <span class="o">=</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span> <span class="o">*</span> <span class="n">fac</span><span class="o">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">watch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Stopwatch</span><span class="bp">()</span>
</span><span class='line'><span class="n">watch</span><span class="o">.</span><span class="nc">Start</span><span class="bp">()</span>
</span><span class='line'><span class="k">let</span> <span class="n">complexComputation</span> <span class="o">=</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span> <span class="o">[</span><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">..</span><span class="mi">51000</span><span class="o">.</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">async</span> <span class="o">{</span> <span class="k">return</span> <span class="n">fac</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">}]</span> <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span><span class="o">;;</span>
</span><span class='line'><span class="n">watch</span><span class="o">.</span><span class="nc">Stop</span><span class="bp">()</span>
</span><span class='line'><span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="n">watch</span><span class="o">.</span><span class="nn">Elapsed</span><span class="p">.</span><span class="nn">Seconds</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span>
</span><span class='line'><span class="n">printfn</span> <span class="s2">&quot;%s&quot;</span> <span class="n">result</span><span class="o">;;</span>
</span><span class='line'>
</span><span class='line'><span class="c">(* RESULTS *)</span>
</span><span class='line'><span class="k">val</span> <span class="n">fac</span> <span class="o">:</span> <span class="kt">float</span> <span class="o">-&gt;</span> <span class="kt">float</span>
</span><span class='line'><span class="k">val</span> <span class="n">watch</span> <span class="o">:</span> <span class="nc">Stopwatch</span>
</span><span class='line'><span class="k">val</span> <span class="n">complexComputation</span> <span class="o">:</span> <span class="kt">float</span> <span class="bp">[]</span> <span class="o">=</span>
</span><span class='line'>  <span class="o">[|</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">6</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">24</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">120</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">720</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">5040</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">40320</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">362880</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="mi">3628800</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">39916800</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">479001600</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">6227020800</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span> <span class="mi">8</span><span class="o">.</span><span class="mi">71782912</span><span class="n">e</span><span class="o">+</span><span class="mi">10</span><span class="o">;</span>
</span><span class='line'>    <span class="mi">1</span><span class="o">.</span><span class="mi">307674368</span><span class="n">e</span><span class="o">+</span><span class="mi">12</span><span class="o">;</span> <span class="mi">2</span><span class="o">.</span><span class="mi">092278989</span><span class="n">e</span><span class="o">+</span><span class="mi">13</span><span class="o">;</span> <span class="mi">3</span><span class="o">.</span><span class="mi">556874281</span><span class="n">e</span><span class="o">+</span><span class="mi">14</span><span class="o">;</span> <span class="mi">6</span><span class="o">.</span><span class="mi">402373706</span><span class="n">e</span><span class="o">+</span><span class="mi">15</span><span class="o">;</span>
</span><span class='line'>    <span class="o">...|]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Results: Non-parallel version is 3.15 times slower. Parallel version 315% faster!</p>

<h2>Conclusion</h2>

<p>There are a lot of things to be excited about in F#. Learning F# will definitely make you a better C# programmer by providing you with more of a functional mindset. I think in the future it would be a fair bet to say that more .NET programmers will begin to inter-operate between these two languages.</p>

<h2>Resource Round-Up</h2>

<p><em>Interesting F# project to watch: WebSharper
</em>Check out my F# stock ticker app on my github account. This is a small project that will read information from yahoo’s financial stock history for any given stock, summarize the data using List functions such as “map” and “reduce” and will then output the results to a C# console application. This code was derived from Luca Bolognese’s original talk at PDC on F#. Luca is actually using F# in an algorithmic trading setting now at Credit Suisse.
*Best Getting Started Video Tutorial on F#</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/11/silverlight-3d-part-two/">Silverlight 3D: Part Two</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-11T02:47:00-05:00" pubdate data-updated="true">Jun 11<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/06/11/silverlight-3d-part-two/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://dl.dropbox.com/u/10021156/blog/Ball2.png"></p>

<h2>Why should you care?</h2>

<p>3D Photorealism is nothing new. Plenty of companies have been substituting photos of their product line for creating photo-realistic 3D renditions instead (big cost savings — Apple is a great example of this). The only issue is that these products are typically displayed in 2D on a company website. This means real-time 3D manipulation is not possible outside of a QuickTime plug-in (which usually displays 2D images) or a 2D flipbook of 3D images where all positions are predefined. Enter Silverlight 5 and Babylon Toolkit. Instead of rendering out content as 2D images, the 3D file format (.obj in our case) can be maintained and manipulated during the web app’s runtime thanks to the new 3D features of Silverlight 5 and the extensibility of the Babylon Toolkit.</p>

<h2>Importing 3D Models into your Silverlight 5 project</h2>

<p>In our previous post we went through a high-level overview of how to manually implement 3D graphics in Silverlight 5 as well as a discussion about how to program against the GPU. We concluded that there are three ways to implement 3D effects in Silverlight 5.</p>

<p>1 – Plot all your vertices individually (by hand).
2 – Plot your vertices algorithmically.
3 – Import a 3D model into your Silverlight application via a third-party API.</p>

<p>For this next example we will use a 3D modeling app named “Modo” to create a soccer ball model. This model will then be used as 3D content in our Silverlight App.</p>

<h2>3D Apps</h2>

<p>Back in the day I used to Modo quite a bit (Here is the only thing I ever made that was worth looking at). For those of you who don’t know Modo, it’s a next-gen 3D modeling, painting, animating and rendering package that is used by many professionals in the 3D industry including Pixar. (Note: Any 3D application that is capable of producing the .OBJ file format will suffice for our purposes:</p>

<ul>
<li>3D Studio Max</li>
<li>Blender</li>
<li>Maya</li>
<li>Sketchup
all seem to be just as capable). If you want to go ahead and create the Soccer Ball using Modo or another 3D program click here for a walkthrough or you can download the whole project here instead.</li>
</ul>


<p>Final Result
<img src="https://dl.dropbox.com/u/10021156/blog/Modo-1024x626.jpg"></p>

<h2>Babylon</h2>

<p>After you have created the model, you will need to download the Babylon Importer Toolkit (big thanks to David Catuhe). The Babylon Toolkit gives us access to XNA-like functionality that would only be accessible in the full version of the XNA game studio. This means we don’t have to go about the process of plotting our vertices individually or even worrying about pixel shaders because Catuhe’s Babylon Toolkit provides abstractions on top of these granular aspects of Silverlight 3D.</p>

<h2>Putting it all together</h2>

<p>After you download the toolkit, create a new project and add the assemblies found inside the toolkit to your Silverlight application. Next, import your .OBJ, .MTL (material) files and .JPG (texture files – if necessary) into your silverlight project and set their build action to “resource.”</p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/Build-Action-Resource.png"></p>

<p>Now you should be able to grab these items as streams and use the Babylon API to call the Import function asynchronously. For a fuller demonstration of this process check out the Babylon sample project of a 3D Viper from Battlestar Galactica and see the code below.</p>

<figure class='code'><figcaption><span>XAML Side </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Grid</span> <span class="na">x:Name=</span><span class="s">&quot;LayoutRoot&quot;</span> <span class="na">Background=</span><span class="s">&quot;Gray&quot;</span> <span class="na">MouseMove=</span><span class="s">&quot;drawingSurface_MouseMove&quot;</span> <span class="na">MouseLeftButtonDown=</span><span class="s">&quot;LayoutRoot_MouseLeftButtonDown&quot;</span> <span class="na">MouseLeftButtonUp=</span><span class="s">&quot;LayoutRoot_MouseLeftButtonUp&quot;</span> <span class="na">MouseEnter=</span><span class="s">&quot;LayoutRoot_MouseEnter&quot;</span> <span class="na">MouseWheel=</span><span class="s">&quot;LayoutRoot_MouseWheel&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;DrawingSurface</span>  <span class="na">Name=</span><span class="s">&quot;drawingSurface&quot;</span> <span class="na">Draw=</span><span class="s">&quot;DrawingSurface_Draw&quot;</span> <span class="na">SizeChanged=</span><span class="s">&quot;drawingSurface_SizeChanged&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;StackPanel</span> <span class="na">Name=</span><span class="s">&quot;waitBar&quot;</span> <span class="na">VerticalAlignment=</span><span class="s">&quot;Center&quot;</span> <span class="na">Visibility=</span><span class="s">&quot;Collapsed&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">&quot;Loading...Please wait&quot;</span> <span class="na">HorizontalAlignment=</span><span class="s">&quot;Center&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;ProgressBar</span> <span class="na">Height=</span><span class="s">&quot;10&quot;</span> <span class="na">Minimum=</span><span class="s">&quot;0&quot;</span> <span class="na">Maximum=</span><span class="s">&quot;100&quot;</span> <span class="na">Margin=</span><span class="s">&quot;20, 10&quot;</span> <span class="na">Name=</span><span class="s">&quot;waitProgressBar&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/StackPanel&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/Grid&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>C# Side </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">Footballs</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">MainPage</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Model</span> <span class="n">model</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">bool</span> <span class="n">mouseLeftDown</span><span class="p">;</span>
</span><span class='line'>        <span class="n">Point</span> <span class="n">startPosition</span><span class="p">;</span>
</span><span class='line'>        <span class="k">readonly</span> <span class="n">OrbitCamera</span> <span class="n">camera</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OrbitCamera</span> <span class="p">{</span> <span class="n">Radius</span> <span class="p">=</span> <span class="m">20</span> <span class="p">};</span>
</span><span class='line'>        <span class="n">StatesManager</span> <span class="n">statesManager</span><span class="p">;</span>
</span><span class='line'>        <span class="n">GraphicsDevice</span> <span class="n">device</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">MainPage</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">InitializeComponent</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">DrawingSurface_Draw</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">DrawEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">device</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">model</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>  <span class="c1">//This will spawn a new thread to grab and initialize our model</span>
</span><span class='line'>                <span class="n">Dispatcher</span><span class="p">.</span><span class="n">BeginInvoke</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">InitModel</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">));</span>
</span><span class='line'>                <span class="n">statesManager</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StatesManager</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">model</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">DateTime</span> <span class="n">start</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// States</span>
</span><span class='line'>            <span class="n">statesManager</span><span class="p">.</span><span class="n">DepthBufferEnable</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>            <span class="n">statesManager</span><span class="p">.</span><span class="n">CullMode</span> <span class="p">=</span> <span class="n">CullMode</span><span class="p">.</span><span class="n">None</span><span class="p">;</span>
</span><span class='line'>            <span class="n">statesManager</span><span class="p">.</span><span class="n">ApplyDepthStencilState</span><span class="p">();</span>
</span><span class='line'>            <span class="n">statesManager</span><span class="p">.</span><span class="n">ApplyRasterizerState</span><span class="p">();</span>
</span><span class='line'>            <span class="n">e</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">BlendState</span> <span class="p">=</span> <span class="n">BlendState</span><span class="p">.</span><span class="n">AlphaBlend</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Draw</span>
</span><span class='line'>     <span class="n">e</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">ClearOptions</span><span class="p">.</span><span class="n">Target</span> <span class="p">|</span> <span class="n">ClearOptions</span><span class="p">.</span><span class="n">DepthBuffer</span><span class="p">,</span> <span class="k">new</span> <span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">//We use BasicEffect instead of manually using pixel/vertex shader</span>
</span><span class='line'>            <span class="k">foreach</span> <span class="p">(</span><span class="n">ModelMesh</span> <span class="n">mesh</span> <span class="k">in</span> <span class="n">model</span><span class="p">.</span><span class="n">Meshes</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">foreach</span> <span class="p">(</span><span class="n">BasicEffect</span> <span class="n">basicEffect</span> <span class="k">in</span> <span class="n">mesh</span><span class="p">.</span><span class="n">Effects</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">basicEffect</span><span class="p">.</span><span class="n">SceneAmbientColor</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Color</span><span class="p">(</span><span class="m">0.3f</span><span class="p">,</span> <span class="m">0.3f</span><span class="p">,</span> <span class="m">0.3f</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span><span class='line'>                    <span class="n">basicEffect</span><span class="p">.</span><span class="n">World</span> <span class="p">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">Identity</span><span class="p">;</span>
</span><span class='line'>                    <span class="n">basicEffect</span><span class="p">.</span><span class="n">View</span> <span class="p">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">View</span><span class="p">;</span>
</span><span class='line'>                    <span class="n">basicEffect</span><span class="p">.</span><span class="n">Projection</span> <span class="p">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">Projection</span><span class="p">;</span>
</span><span class='line'>                    <span class="n">basicEffect</span><span class="p">.</span><span class="n">LightPosition</span> <span class="p">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">Position</span> <span class="p">+</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span>
</span><span class='line'>                    <span class="n">basicEffect</span><span class="p">.</span><span class="n">CameraPosition</span> <span class="p">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">Position</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">model</span><span class="p">.</span><span class="n">Draw</span><span class="p">();</span>
</span><span class='line'>            <span class="n">camera</span><span class="p">.</span><span class="n">ApplyInertia</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="kt">double</span> <span class="n">duration</span> <span class="p">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">Subtract</span><span class="p">(</span><span class="n">start</span><span class="p">).</span><span class="n">Ticks</span> <span class="p">/</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">TicksPerMillisecond</span><span class="p">;</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">verticesCount</span> <span class="p">=</span> <span class="n">model</span><span class="p">.</span><span class="n">Meshes</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">v</span> <span class="p">=&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">VerticesCount</span><span class="p">);</span>
</span><span class='line'>            <span class="n">e</span><span class="p">.</span><span class="n">InvalidateSurface</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">InitModel</span><span class="p">(</span><span class="n">GraphicsDevice</span> <span class="n">device</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'><span class="n">Stream</span> <span class="n">objStream</span> <span class="p">=</span> <span class="n">Application</span><span class="p">.</span><span class="n">GetResourceStream</span><span class="p">(</span><span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="s">&quot;/Footballs;component/Models/Brazile.obj&quot;</span><span class="p">,</span> <span class="n">UriKind</span><span class="p">.</span><span class="n">Relative</span><span class="p">)).</span><span class="n">Stream</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">ObjImporter</span> <span class="n">importer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ObjImporter</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">importer</span><span class="p">.</span><span class="n">OnImportCompleted</span> <span class="p">+=</span> <span class="n">m</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">waitBar</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Collapsed</span><span class="p">;</span>
</span><span class='line'>                <span class="n">model</span> <span class="p">=</span> <span class="n">m</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">drawingSurface</span><span class="p">.</span><span class="n">Invalidate</span><span class="p">();</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Report loading progress</span>
</span><span class='line'>            <span class="n">importer</span><span class="p">.</span><span class="n">OnImportProgressChanged</span> <span class="p">+=</span> <span class="n">p</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">waitProgressBar</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="n">p</span><span class="p">;</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>            <span class="n">waitBar</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Visible</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//THIS IS WHERE ALL THE MAGIC HAPPENS</span>
</span><span class='line'> <span class="n">importer</span><span class="p">.</span><span class="n">ImportAsync</span><span class="p">(</span><span class="n">objStream</span><span class="p">,</span> <span class="n">GetResourceStream</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">ImportationOptions</span><span class="p">.</span><span class="n">Optimize</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Stream</span> <span class="nf">GetResourceStream</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="n">Application</span><span class="p">.</span><span class="n">GetResourceStream</span><span class="p">(</span><span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;/Footballs;component/Models/{0}&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">UriKind</span><span class="p">.</span><span class="n">Relative</span><span class="p">)).</span><span class="n">Stream</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">catch</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Dispatcher</span><span class="p">.</span><span class="n">BeginInvoke</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="s">&quot;Unable to find &quot;</span> <span class="p">+</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">MessageBoxButton</span><span class="p">.</span><span class="n">OK</span><span class="p">));</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//This is the resizing section</span>
</span><span class='line'>        <span class="cp">#region Aspect ratio</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">drawingSurface_SizeChanged</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">SizeChangedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">ComputeAspectRatio</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">void</span> <span class="nf">ComputeAspectRatio</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">camera</span><span class="p">.</span><span class="n">AspectRatio</span> <span class="p">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">drawingSurface</span><span class="p">.</span><span class="n">ActualWidth</span> <span class="p">/</span> <span class="n">drawingSurface</span><span class="p">.</span><span class="n">ActualHeight</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">UserControl_Loaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">ComputeAspectRatio</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="cp">#endregion</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//This is the mouse section</span>
</span><span class='line'>        <span class="cp">#region Mouse</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">drawingSurface_MouseMove</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">MouseEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(!</span><span class="n">mouseLeftDown</span><span class="p">)</span>
</span><span class='line'>                <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">Point</span> <span class="n">currentPosition</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">(</span><span class="n">drawingSurface</span><span class="p">);</span>
</span><span class='line'>            <span class="n">camera</span><span class="p">.</span><span class="n">InertialAlpha</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">currentPosition</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">startPosition</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="p">*</span> <span class="n">camera</span><span class="p">.</span><span class="n">AngularSpeed</span><span class="p">;</span>
</span><span class='line'>            <span class="n">camera</span><span class="p">.</span><span class="n">InertialBeta</span> <span class="p">-=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">currentPosition</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">startPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="p">*</span> <span class="n">camera</span><span class="p">.</span><span class="n">AngularSpeed</span><span class="p">;</span>
</span><span class='line'>            <span class="n">startPosition</span> <span class="p">=</span> <span class="n">currentPosition</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">LayoutRoot_MouseLeftButtonDown</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">MouseButtonEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">mouseLeftDown</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>            <span class="n">startPosition</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">(</span><span class="n">drawingSurface</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">LayoutRoot_MouseLeftButtonUp</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">MouseButtonEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">mouseLeftDown</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">LayoutRoot_MouseEnter</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">MouseEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">mouseLeftDown</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">LayoutRoot_MouseWheel</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Input</span><span class="p">.</span><span class="n">MouseWheelEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">camera</span><span class="p">.</span><span class="n">Radius</span> <span class="p">-=</span> <span class="n">e</span><span class="p">.</span><span class="n">Delta</span> <span class="p">*</span> <span class="n">camera</span><span class="p">.</span><span class="n">Radius</span> <span class="p">/</span> <span class="m">1000.0f</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="cp">#endregion</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>In this tutorial we had a brief overview of how 3D content is traditionally served on the web. We then discussed how Silverlight 5 combined with the Babylon toolkit expedites the process of dynamic content delivery while proceeding to create our own 3D model and host it in a new Silverlight 5 App. Hope this series was helpful. Questions/Comments/Concerns/Cries of Outrage? Feel free to comment.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/26/silverlight-3d-part-one/">Silverlight 3D: Part One</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-26T16:17:00-05:00" pubdate data-updated="true">May 26<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/05/26/silverlight-3d-part-one/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://dl.dropbox.com/u/10021156/blog/Ball.png"></p>

<h2>The Silverlight 5 Beta</h2>

<p>It’s no secret that Microsoft has released the beta version of Silverlight 5 with many new and surprising features. But what might be unfamiliar territory for some is the inclusion of a low-level 3D API based on the XNA stack. That’s right, the core of the XNA Game Studio is now built into Silverlight (with some caveats of course). “But isn’t XNA just for games?” Mostly, yes. But that hasn’t stopped Microsoft from allowing developers to get creative. Check out John Papa’s demo at MIX11 of a 3D House Builder Simulator. 3D Product Visualization is now a reality and is a viable solution for any developer wanting to spice up content delivery. If you aren’t convinced take a look at the SLARToolkit (Silverlight Augemented Reality) for more cool effects, or the 3D rendition of Scott Guthrie way back at the firestarter event. If that still hasn’t caught your attention then stop reading this post. But for the rest of you, we’ll go over what it takes to build and display 3D graphics in SL5.</p>

<h2>Three ways to build 3D graphics in Silverlight 5:</h2>

<p>Create your models by hand (by plotting each individual vertex) this can be is very tedious.
Create your model algorithmically (Check out the Solar Winds Project)
Import your model from a third-party modeling tool</p>

<p>If you have already developed XNA applications/games you will find that XNA for Silverlight is very similar, albeit there are some differences. Silverlight 5 provides a new User Control named “Drawing Surface” which includes the “Draw” event. This renders all 3D content on a separate thread known as the “composition” thread. This also updates all projection, view and world matrices which are responsible for positioning things like the camera and the model in 3D space. So let’s get started creating our own polygon in 3D space. Note: This is part one of a two-part series. In this series we will focus on the theory and abstract concepts behind the creation of 3D graphics in Silverlight 5 to produce a simple triangle. Part two will be much cooler.</p>

<h2>Essential Resources</h2>

<p>In order to complete this tutorial you will need to have the following on your machine:
DirectX SDK
Visual Studio 2010
Silverlight 5 Beta
Microsoft.Xna.Framework.Math.dll</p>

<h2>Five Steps</h2>

<p>At a high level there are 5 basic steps to follow in order to render 3D graphics in Silverlight 5 (Straight from the .CHM).
1. Setup the initial project
2. Create a structure to hold vertex data (includes VertexDeclaration), instantiate the struct, and pass it into your Vertex Buffer.
3. Create World view, Camera view, and Projection space matrices.
4. Create PixelShader and VertexShader objects.
5. Raise the Draw Event.</p>

<p>This may all sound complicated initially, but as you continue to read it will begin to make sense. Also, this is meant to be a crash-course guide to XNA and SL5. If you want real depth I recommend you check out this book. So let’s get started.</p>

<h2>Getting Started with the 3D API – Your first triangle.</h2>

<p>Create a new Silverlight Project named “FirstTriangle” make sure you check that it is a Silverlight 5 application. Make sure to add a web project as well.</p>

<h3>Step 1: Turn it on</h3>

<p>By default GPU Acceleration is not enabled, so go ahead and include this extra param tag into your Triangle web application. You will be unable to render graphics without it.</p>

<figure class='code'><figcaption><span>Turn it on </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;EnableGPUAcceleration&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--  Set other parameters here  --&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Add the control, Add the Event Handler, Declare your variables </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Grid</span> <span class="na">x:Name=</span><span class="s">&quot;LayoutRoot&quot;</span> <span class="na">Background=</span><span class="s">&quot;Black&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;DrawingSurface</span> <span class="na">Name=</span><span class="s">&quot;surface&quot;</span> <span class="na">Draw=</span><span class="s">&quot;surface_Draw&quot;</span>  <span class="na">Loaded=</span><span class="s">&quot;surface_Loaded&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/Grid&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The two events we will be focusing on in this application primarily are the “Draw” event and the “Loaded” event. Also, declare these variables in your MainPage.xaml.cs class. We’ll dive into what they mean in a little later.</p>

<figure class='code'><figcaption><span># Shaders and Buffers </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">VertexShader</span> <span class="n">vs</span><span class="p">;</span>
</span><span class='line'><span class="n">PixelShader</span> <span class="n">ps</span><span class="p">;</span>
</span><span class='line'><span class="n">VertexBuffer</span> <span class="n">vb</span><span class="p">;</span>
</span><span class='line'><span class="n">Matrix</span> <span class="n">viewproj</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 2: Create Structure to hold Vertex Data</h3>

<p>Before we can go any further it’s important to note exactly what we’re doing when we program against the GPU. Check out the image below to see the pipeline of just how the vertices we describe get displayed up on the screen.</p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/XNA-explanation-227x300.png"></p>

<blockquote><p>“Points in three-dimensional space are represented as a 3-component vector called a vertex. A vertex contains an x, y, and z component. Vertices are connected together to form primitives, such as triangles, which are defined with three vertices. Multiple triangles can be combined together into lists or stripes which from a mesh. Meshes of triangles are combined together to create complex shapes. For example, a square can be drawn using two triangles. ”</p></blockquote>


<h3>Vertex Information</h3>

<p>Vertex information is typically stored in a structure which may include data such as position, color, and texture coordinates. So in your MainPage.xaml.cs add this struct below our MainPage class. This struct defines the type of content our vertices will hold (in this case only Position and Color data). Our struct will expose a static, read-only, Vertex Declaration that will be passed into the VertexBuffer. A VertexDeclaration defines the layout of the vertex data.</p>

<figure class='code'><figcaption><span># VertexDeclaration </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">public</span> <span class="k">struct</span> <span class="n">VertexPositionColor</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">public</span> <span class="n">Vector3</span> <span class="n">Position</span><span class="p">;</span>
</span><span class='line'>        <span class="n">public</span> <span class="n">Color</span> <span class="n">Color</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">public</span> <span class="nf">VertexPositionColor</span><span class="p">(</span><span class="n">Vector3</span> <span class="n">Position</span><span class="p">,</span> <span class="n">Color</span> <span class="n">Color</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">this</span><span class="p">.</span><span class="n">Position</span> <span class="o">=</span> <span class="n">Position</span><span class="p">;</span>
</span><span class='line'>            <span class="n">this</span><span class="p">.</span><span class="n">Color</span> <span class="o">=</span> <span class="n">Color</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">public</span> <span class="k">static</span> <span class="n">readonly</span> <span class="n">VertexDeclaration</span> <span class="n">VertexDeclaration</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VertexDeclaration</span><span class="p">(</span><span class="n">new</span> <span class="n">VertexElement</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">VertexElementFormat</span><span class="p">.</span><span class="n">Vector3</span><span class="p">,</span> <span class="n">VertexElementUsage</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="n">new</span> <span class="n">VertexElement</span><span class="p">((</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="n">VertexElementFormat</span><span class="p">.</span><span class="n">Color</span><span class="p">,</span> <span class="n">VertexElementUsage</span><span class="p">.</span><span class="n">Color</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The VertexDeclaration takes in four parameters. The first corresponds to the offset. Your first VertexElement should not contain an offset since it is the first element. The next VertexElement should be offset by 12 bytes, or by the size of VertexElement (which was a Vector3 in our case). Note: Vector3 contains 3 floats. One float is 4 bytes, Therefore, 4 bytes * 3 floats = 12 bytes… that’s where the 12 is coming from. (Note: Vector3 is in the Microsoft.XNA.Framework.Math.dll, hopefully this will be included in Silverlight 5 too). So, each vertex will contain information about position as well as color. (You can also map textures to 3D objects as well using another VertexElementFormat of type “Texture” – We will dive into this in Part 2).</p>

<p>You can think of this struct as your data model, describing how your vertex data will be interpreted by the GPU. You can also think of the instantiation of this struct as your view model. So we will instantiate this struct inside of our surface_loaded event handler to begin the initialization process.</p>

<h3>Vertex Buffer</h3>

<figure class='code'><figcaption><span># Vertex Buffer </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">private</span> <span class="kt">void</span> <span class="nf">surface_Loaded</span><span class="p">(</span><span class="n">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'><span class="c1">//get device</span>
</span><span class='line'><span class="n">GraphicsDevice</span> <span class="n">device</span> <span class="o">=</span> <span class="n">GraphicsDeviceManager</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//Declare struct</span>
</span><span class='line'> <span class="n">VertexPositionColor</span><span class="p">[]</span> <span class="n">vertices</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VertexPositionColor</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Plot your verts</span>
</span><span class='line'><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VertexPositionColor</span><span class="p">(</span><span class="n">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/*top*/</span><span class="p">,</span> <span class="n">new</span> <span class="n">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/*red*/</span><span class="p">);</span>
</span><span class='line'><span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VertexPositionColor</span><span class="p">(</span><span class="n">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/*left*/</span><span class="p">,</span> <span class="n">new</span> <span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/*green*/</span><span class="p">);</span>
</span><span class='line'><span class="n">vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VertexPositionColor</span><span class="p">(</span><span class="n">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/*right*/</span><span class="p">,</span> <span class="n">new</span> <span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/*blue*/</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Assign it to buffer</span>
</span><span class='line'><span class="n">vb</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VertexBuffer</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">VertexPositionColor</span><span class="p">.</span><span class="n">VertexDeclaration</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BufferUsage</span><span class="p">.</span><span class="n">WriteOnly</span><span class="p">);</span>
</span><span class='line'><span class="n">vb</span><span class="p">.</span><span class="n">SetData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vertices</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Set Camera</span>
</span><span class='line'><span class="n">view</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreateLookAt</span><span class="p">(</span><span class="n">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">Up</span><span class="p">);</span> <span class="c1">//defines the position of the camera in 3D space</span>
</span><span class='line'><span class="n">projection</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">.</span><span class="n">CreatePerspectiveFieldOfView</span><span class="p">(</span><span class="n">MathHelper</span><span class="p">.</span><span class="n">PiOver4</span><span class="p">,</span> <span class="mf">1.667f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">//viewing angle, aspect ratio, near and far axis</span>
</span><span class='line'><span class="n">viewproj</span> <span class="o">=</span> <span class="n">view</span> <span class="o">*</span> <span class="n">projection</span><span class="p">;</span> <span class="c1">//This represents our world space which will be passed into our vertex shader.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Set up Shaders</span>
</span><span class='line'><span class="n">ps</span> <span class="o">=</span> <span class="n">PixelShader</span><span class="p">.</span><span class="n">FromStream</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Application</span><span class="p">.</span><span class="n">GetResourceStream</span><span class="p">(</span><span class="n">new</span> <span class="n">Uri</span><span class="p">(</span><span class="err">@</span><span class="s">&quot;FirstTriangle;component/Triangle.ps&quot;</span><span class="p">,</span> <span class="n">UriKind</span><span class="p">.</span><span class="n">Relative</span><span class="p">)).</span><span class="n">Stream</span><span class="p">);</span>
</span><span class='line'><span class="n">vs</span> <span class="o">=</span> <span class="n">VertexShader</span><span class="p">.</span><span class="n">FromStream</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Application</span><span class="p">.</span><span class="n">GetResourceStream</span><span class="p">(</span><span class="n">new</span> <span class="n">Uri</span><span class="p">(</span><span class="err">@</span><span class="s">&quot;FirstTriangle;component/Triangle.vs&quot;</span><span class="p">,</span> <span class="n">UriKind</span><span class="p">.</span><span class="n">Relative</span><span class="p">)).</span><span class="n">Stream</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Graphics Device</h3>

<p>The GraphicsDevice is a working representation of your GPU, so grab it. Next, you will create a vertex array containing three vertices to represent your triangle. The code should be self-explanatory. The next two lines of code create a new VertexBuffer and assign the structure of our triangle to it. A VertexBuffer is a data buffer that contains a VertexDeclaration which describes the buffer layout to the graphics device. The vertex buffer also contains all the vertex data.</p>

<blockquote><p>In a 3D scene there are typically multiple views that must be maintained. Three common views are the world space, view space, and projection space. These are defined as 4×4 matrices. The world space is the main point of reference. It is the space that objects are placed in. The view space is composed of three components. The position of the camera in world space, the coordinates in world space that the camera is looking at, and the direction that is up. For example, if the first component was 0,0,5, then this indicates that camera is at position (0,0,5). If the second component was 0,0,0, (Vector3.Zero) then this indicates that the camera is pointing towards the origin of world space. Finally, if the final component is 0,1,0, (Vector.Up) then this indicates that the up direction of the camera is along the positive y-axis. The final space is the projection matrix. This is the actual region, within the view space, that the camera sees. The space is defined as a frustum. A frustum is like a pyramid that has the pointed portion cut off leaving a flat plane. Everything in front of the front plane of the frustum is clipped and everything behind the back plane of the frustum is clipped. So, only the objects within the region between the front and back planes are rendered.”</p></blockquote>


<p>The first parameter, MathHelper.PiOver4, corresponds to .785 radians which is roughly 45 degree field of view, The next parameter is 1.667f which corresponds to a 4:3 aspect ratio. 1 represents the near distance plane and 10 the far distance plane. Only vertices between these two numbers will be viewable.</p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/viewingFrustrum.png" title="An illustrated look at the viewing frustrum" ></p>

<h3>Step 4: Working with shaders</h3>

<p>After we multiply our view and projection matrices we yield world space. This space will then be passed into what is known as a vertex shader. A vertex shader is a graphics processing function used to add special effects to objects in a 3D environment. Vertex shaders are run once for each vertex given to the graphics processor. The purpose is to transform each vertex’s 3D position in virtual space to the 2D coordinate at which it appears on the screen (as well as a depth value for the Z-buffer). Vertex shaders can manipulate properties such as position, color, and texture coordinate, but cannot create new vertices. The output of the vertex shader goes to the next stage in the pipeline, which is either a geometry shader if present or the rasterizer otherwise. Similarly, A pixel shader is a computation kernel function that computes color and other attributes of each pixel. Pixel shaders range from always outputting the same color, to applying a lighting value, to doing bump mapping, shadows, specular highlights, translucency and other phenomena. For our purposes we will define a basic vertex and pixel shader using HLSL (High Level Shader Language) that will not perform any additional manipulations but simply pass our data through for rendering. Here is the code below:</p>

<figure class='code'><figcaption><span>Triangle.vs.hlsl </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">// transformation matrix provided by the application</span>
</span><span class='line'><span class="n">float4x4</span> <span class="n">WorldViewProj</span> <span class="p">:</span> <span class="n">register</span><span class="p">(</span><span class="n">c0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// vertex input to the shader</span>
</span><span class='line'><span class="k">struct</span> <span class="nc">VertexData</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">float3</span> <span class="n">Position</span> <span class="p">:</span> <span class="n">POSITION</span><span class="p">;</span>
</span><span class='line'>  <span class="n">float4</span> <span class="n">Color</span> <span class="p">:</span> <span class="n">COLOR</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// vertex shader output passed through to geometry</span>
</span><span class='line'><span class="c1">// processing and a pixel shader</span>
</span><span class='line'><span class="k">struct</span> <span class="nc">VertexShaderOutput</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">float4</span> <span class="n">Position</span> <span class="p">:</span> <span class="n">POSITION</span><span class="p">;</span>
</span><span class='line'>  <span class="n">float4</span> <span class="n">Color</span> <span class="p">:</span> <span class="n">COLOR</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// main shader function</span>
</span><span class='line'><span class="n">VertexShaderOutput</span> <span class="nf">main</span><span class="p">(</span><span class="n">VertexData</span> <span class="n">vertex</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">VertexShaderOutput</span> <span class="n">output</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// apply standard transformation for rendering</span>
</span><span class='line'>  <span class="n">output</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">float4</span><span class="p">(</span><span class="n">vertex</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">WorldViewProj</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// pass the color through to the next stage</span>
</span><span class='line'>  <span class="n">output</span><span class="p">.</span><span class="n">Color</span> <span class="p">=</span> <span class="n">vertex</span><span class="p">.</span><span class="n">Color</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Triangle.pl.hlsl </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">struct</span> <span class="nc">VertexShaderOutput</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">float4</span> <span class="n">Position</span> <span class="p">:</span> <span class="n">POSITION</span><span class="p">;</span>
</span><span class='line'>  <span class="n">float4</span> <span class="n">Color</span> <span class="p">:</span> <span class="n">COLOR</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// main shader function</span>
</span><span class='line'><span class="n">float4</span> <span class="nf">main</span><span class="p">(</span><span class="n">VertexShaderOutput</span> <span class="n">vertex</span><span class="p">)</span> <span class="p">:</span> <span class="n">COLOR</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">vertex</span><span class="p">.</span><span class="n">Color</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Compile</h3>

<p>These shaders will then need to be compiled using fxc.exe (part of the DirectX SDK) and imported into your silverlight application. Make sure you set them with a build action of “resource.”
Next, find your fxc.exe application. Mine is located here: C:\Program Files (x86)\Microsoft DirectX SDK (June 2010)\Utilities\bin\x64.
so open up a command prompt and type</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd C:\Program Files (x86)\Microsoft DirectX SDK (June 2010)\Utilities\bin\x64</span></code></pre></td></tr></table></div></figure>


<p>This will navigate you to the fxc.exe directory.
Now in order to compile your vertex shader you should execute this command</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Fxc.exe /T ps_2_0 /O3 /Zpr /Fo 
</span><span class='line'>C:\users\djohnson\desktop\Triangle.ps 
</span><span class='line'>C:\users\djohnson\desktop\Triangle.ps.hlsl</span></code></pre></td></tr></table></div></figure>


<h3>Note</h3>

<p>Note: Since my HLSL files are located on my desktop I am referencing them there as well as projecting a Triangle.ps file for output. (This is the pixel shader extension and the file that should be created if you executed the command properly. Do the same with the vertex shader).
Command to compile a Vertex Shader using FXC.exe</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\Program Files (x86)\Microsoft DirectX SDK (June 2010)\Utilities\bin\x64\Fxc.exe /T vs_2_0 /O3 /Zpr /Fo 
</span><span class='line'>C:\users\djohnson\desktop\Triangle.vs 
</span><span class='line'>C:\users\djohnson\desktop\Triangle.vs.hlsl</span></code></pre></td></tr></table></div></figure>


<p>(Note: the vs_2_0 in this command is differen than the ps_2_0 in the previous)
After they are built import both the .ps and .vs files into your silverlight project and make sure their build action is set to resource. But if you are really lazy and don’t want to compile your own shaders you can just grab my pre-compiled shaders and import them here.</p>

<h3>Step 5</h3>

<figure class='code'><figcaption><span>The Draw Event - Bringing it all together </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">surface_Draw</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">DrawEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>         <span class="n">GraphicsDevice</span> <span class="n">device</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">GraphicsDevice</span><span class="p">;</span>
</span><span class='line'>         <span class="c1">// Clear the GraphicsDevice</span>
</span><span class='line'>         <span class="n">device</span><span class="p">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">ClearOptions</span><span class="p">.</span><span class="n">Target</span> <span class="p">|</span> <span class="n">ClearOptions</span><span class="p">.</span><span class="n">DepthBuffer</span><span class="p">,</span> <span class="n">Color</span><span class="p">.</span><span class="n">Transparent</span><span class="p">,</span> <span class="m">10.0f</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</span><span class='line'>         <span class="c1">//Set up device device</span>
</span><span class='line'>         <span class="n">device</span><span class="p">.</span><span class="n">SetVertexBuffer</span><span class="p">(</span><span class="n">vb</span><span class="p">);</span>
</span><span class='line'>         <span class="n">device</span><span class="p">.</span><span class="n">SetVertexShader</span><span class="p">(</span><span class="n">vs</span><span class="p">);</span>
</span><span class='line'>         <span class="n">device</span><span class="p">.</span><span class="n">SetPixelShader</span><span class="p">(</span><span class="n">ps</span><span class="p">);</span>
</span><span class='line'>         <span class="n">device</span><span class="p">.</span><span class="n">SetVertexShaderConstantFloat4</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="k">ref</span> <span class="n">viewproj</span><span class="p">);</span>
</span><span class='line'>         <span class="n">device</span><span class="p">.</span><span class="n">DrawPrimitives</span><span class="p">(</span><span class="n">PrimitiveType</span><span class="p">.</span><span class="n">TriangleStrip</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">vb</span><span class="p">.</span><span class="n">VertexCount</span> <span class="p">/</span> <span class="m">3</span><span class="p">);</span>
</span><span class='line'>         <span class="n">e</span><span class="p">.</span><span class="n">InvalidateSurface</span><span class="p">();</span>
</span><span class='line'>     <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Draw event handler is where all action happens. In this handler we are once again grabbing the current graphics device, but this time we are invoking the clear method before we call our Draw Primitives. (Note: The Draw method runs in a loop similar to an XNA game loop rendering out each frame individually). Next, we pass in our VertexBuffer (which contains the vertex data) into our device. We then set both the vertex shader and pixel shader (which describe how our content is displayed pre-rasterization and post-rasterization). Finally, we pass in our view projection matrix into our vertex shader and call the DrawPrimitives method. In the Draw primitives method we are using “Triangle Strip.” This will create a polygon from the last vertice that was added in 3D space. This is accomplished by analyzing the two previous vertex positions and attempting to create a triangular polygon utilizing those positions. Invalidating the surface will invoke the draw method to be called again and will re-render out the content with our without any geometry transformations. (Geometry transformations can be accomplished through manipulation of the view and projection matrices, please see the third tutorial for more information on that).</p>

<p>If all goes according to plan you should have your first Triangle mesh drawn into 3D space.</p>

<p><img src="https://dl.dropbox.com/u/10021156/blog/TriangleResult-300x261.png" title="All that hard work for a simple triangle" ></p>

<p>If you have any issues here is the source code.</p>

<p>Let me know if you have any questions comments concerning any of the info above. Cya in Part 2.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
	  <img src="http://gravatar.com/avatar/738f71369f6bb7c0839d06f8f4b20580?s=200 " alt="Gravatar image" title="Gravatar Image" />
  </section>


<section>
  <h1>About Me</h1>
  <p>David M. Johnson is a life-long learner, developer, traveler, almost paleo, amateur theologian and chicagoan.</p>
    </section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/08/28/fixing-the-repos-loading-dot-dot-dot-message-in-octopress/">Fixing the &#8216;Repos loading&#8230;&#8217; message in Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/28/fixing-github-dot-js-in-octopress/">github.js in Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/17/first-post-on-new-blog/">First post on new blog</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/12/roll-your-own-twitter-feed-with-backbone-dot-js/">Roll your own Twitter Feed with Backbone.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/08/31/testing-html5-web-apps-with-watir/">Testing HTML5 Web Apps with WATIR</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/djohnsonm">@djohnsonm</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'djohnsonm',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("djohnsonm", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/djohnsonm" class="twitter-follow-button" data-show-count="false">Follow @djohnsonm</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/115046248563331704822?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
	Google+    
</a>
</h1>
</section>



<section>
<h1>Stack Overflow</h1>
<a href="http://stackoverflow.com/users/453261/dave"><img src="http://stackoverflow.com/users/flair/453261.png" width="208" height="58" alt="profile for dave at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for dave at Stack Overflow, Q&amp;A for professional and enthusiast programmers"></a>
</section>


<section>
  <h1>Coderwall</h1>
  <ul id="cw_badges">
    <li class="loading">Status updating&#8230;</li>
  </ul>

  <script type="text/javascript">
    var coderwall = (function(){
      function render(options, badges){
        var fragment = '',
            t = $(options.target)[0],
            height = 65,
            width = 65,
            index;

        for (index in badges) {
          fragment += '<a class="cw_badge"title="' + badges[index].description + '" href="http://coderwall.com/' + options.user + '">';
          fragment +=   '<img alt="' + badges[index].description + '" height="' + width + '" width="' + height + '" src="' + badges[index].badge + '"/>';
          fragment += '</a>';
        }

        t.innerHTML = fragment;
      }
      return {
        showBadges: function(options){
          $.ajax({
              url: 'http://coderwall.com/' + options.user + '.json?callback=?'
            , type: 'jsonp'
            , error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); }
            , success: function(res) {
                render(options, res.data.badges);
            }
          });
        }
      };
    })();

    $.domReady(function(){
      if (!window.jXHR){
        var jxhr = document.createElement('script');
        jxhr.type = 'text/javascript';
        jxhr.src = '/javascripts/libs/jXHR.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(jxhr, s);
      }
      if (!window.$){
        var b = document.createElement('script');
        b.type = 'text/javascript';
        b.src = '/javascripts/ender.js';
        var sc = document.getElementsByTagName('script')[0];
        sc.parentNode.insertBefore(jxhr, s);
      }
      coderwall.showBadges({
        user: 'djohnsonm',
        target: '#cw_badges'
      });
    });
  </script>
  <style type="text/css">
    .cw_badge img {
      padding: 5px;
      border: 0 none !important;
      -moz-box-shadow: none !important;
      -webkit-box-shadow: none !important;
      -o-box-shadow: none !important;
      box-shadow: none !important;
    }
  </style>
</section>

<section>
  <h1>Tag Cloud</h1>
      <span id="tag-cloud"><a href='/blog/categories/-net' style='font-size: 130.0%'>.NET</a> <a href='/blog/categories/3d' style='font-size: 160.0%'>3D</a> <a href='/blog/categories/blogging' style='font-size: 130.0%'>blogging</a> <a href='/blog/categories/code' style='font-size: 130.0%'>code</a> <a href='/blog/categories/css3' style='font-size: 130.0%'>css3</a> <a href='/blog/categories/f-' style='font-size: 130.0%'>f#</a> <a href='/blog/categories/functional-programming' style='font-size: 130.0%'>functional-programming</a> <a href='/blog/categories/github' style='font-size: 130.0%'>github</a> <a href='/blog/categories/html5' style='font-size: 160.0%'>html5</a> <a href='/blog/categories/javascript' style='font-size: 130.0%'>javascript</a> <a href='/blog/categories/jquery' style='font-size: 130.0%'>jQuery</a> <a href='/blog/categories/migrated' style='font-size: 130.0%'>migrated</a> <a href='/blog/categories/node-js' style='font-size: 130.0%'>node.js</a> <a href='/blog/categories/octopress' style='font-size: 130.0%'>octopress</a> <a href='/blog/categories/ruby' style='font-size: 130.0%'>ruby</a> <a href='/blog/categories/silverlight' style='font-size: 160.0%'>silverlight</a> <a href='/blog/categories/subtle-patterns' style='font-size: 130.0%'>subtle-patterns</a> <a href='/blog/categories/testing' style='font-size: 130.0%'>testing</a> <a href='/blog/categories/twitter-bootstrap' style='font-size: 130.0%'>twitter-bootstrap</a> <a href='/blog/categories/watir' style='font-size: 130.0%'>WATIR</a> <a href='/blog/categories/xna' style='font-size: 160.0%'>XNA</a> </span>
      </section>

<section>
  <h1>Categories</h1>
      <ul id="category-list"><li><a href='/blog/categories/-net'>.NET (1)</a></li><li><a href='/blog/categories/3d'>3D (2)</a></li><li><a href='/blog/categories/blogging'>blogging (1)</a></li><li><a href='/blog/categories/code'>code (1)</a></li><li><a href='/blog/categories/css3'>css3 (1)</a></li><li><a href='/blog/categories/f-'>f# (1)</a></li><li><a href='/blog/categories/functional-programming'>functional-programming (1)</a></li><li><a href='/blog/categories/github'>github (1)</a></li><li><a href='/blog/categories/html5'>html5 (2)</a></li><li><a href='/blog/categories/javascript'>javascript (1)</a></li><li><a href='/blog/categories/jquery'>jQuery (1)</a></li><li><a href='/blog/categories/migrated'>migrated (1)</a></li><li><a href='/blog/categories/node-js'>node.js (1)</a></li><li><a href='/blog/categories/octopress'>octopress (1)</a></li><li><a href='/blog/categories/ruby'>ruby (1)</a></li><li><a href='/blog/categories/silverlight'>silverlight (2)</a></li><li><a href='/blog/categories/subtle-patterns'>subtle-patterns (1)</a></li><li><a href='/blog/categories/testing'>testing (1)</a></li><li><a href='/blog/categories/twitter-bootstrap'>twitter-bootstrap (1)</a></li><li><a href='/blog/categories/watir'>WATIR (1)</a></li><li><a href='/blog/categories/xna'>XNA (2)</a></li></ul>
      </section>
<section>
<h1>Ads</h1>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-5681032540615565";
/* dmj */
google_ad_slot = "6265218554";
google_ad_width = 200;
google_ad_height = 200;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - david m. johnson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'djohnsonm';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
